(()=>{"use strict";var e,t=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");o(t)}},n=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)},o=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)},r=function(e){e.target.classList.contains("popup")&&o(e.target)},c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-24/",headers:{authorization:"c430b10e-6e02-4ef6-8316-b9743be3525c","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(result.status))},i=function(e){e.remove()},u=function(e){e.classList.toggle("card__like-button_is-active")},s=function(e,t,n){var o;(o=e._id,fetch("".concat(c.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:c.headers}).then((function(e){return a(e)}))).then((function(e){console.log(e),t(n)})).catch((function(e){console.log(e)}))},l=function(e,t,n){var o=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),r=o.querySelector(".card__image"),c=o.querySelector(".card__title"),a=o.querySelector(".card__like-counter"),u=o.querySelector(".card__delete-button");r.src=e.link,r.alt=e.name,c.textContent=e.name,a.textContent=e.likes.length;var l=o.querySelector(".card__like-button");return function(t,n){e.likes.find((function(e){return e._id===t}))&&n.classList.add("card__like-button_is-active")}(n,l),l.addEventListener("click",(function(){return t.handleLikeCard(l,e._id,a)})),r.addEventListener("click",(function(){return t.increaseImage(r,c)})),e.owner._id!==n?u.remove():u.addEventListener("click",(function(){s(e,i,o)})),o},d=function(e,t,n){var o=e.querySelector(".".concat(t.name,"-error"));o.classList.remove(n.inputErrorClass),t.classList.remove(n.errorClass),o.textContent="",t.setCustomValidity("")},f=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)},p=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));e.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass),n.forEach((function(n){d(e,n,t)}))},m=document.querySelector(".places__list"),h=document.querySelectorAll(".popup"),_=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),y=document.querySelector(".popup__image"),S=document.querySelector(".popup__caption"),b=document.querySelector(".popup_type_image"),g=document.querySelector(".popup_change_avatar"),E=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),L=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),x=document.querySelectorAll("#button"),T=document.forms.newPlace,A=document.forms.editProfile,U=A.name,P=A.description,B=document.forms.profileImage,w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},D={openModal:n,closeModal:o,handleLikeCard:function(e,t,n){var o;e.classList.contains("card__like-button_is-active")?(o=t,fetch("".concat(c.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:c.headers}).then((function(e){return a(e)}))).then((function(t){n.textContent=t.likes.length,u(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then((function(e){return a(e)}))}(t).then((function(t){n.textContent=t.likes.length,u(e)})).catch((function(e){console.log(e)}))},increaseImage:N,handleDeleteCard:s};function M(e){e?x.forEach((function(e){return e.innerText="Загружается..."})):x.forEach((function(e){return e.innerText="Сохранить"}))}var N=function(e,t){y.src=e.src,y.alt=e.alt,S.textContent=t.textContent,n(b)};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);f(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.name,"-error"));r.classList.add(o.inputErrorClass),r.textContent=n,t.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),f(n,o,t)}))}))}(t,e)}))}(w),Promise.all([fetch("".concat(c.baseUrl,"/users/me"),{method:"GET",headers:c.headers}).then((function(e){return a(e)})),fetch("".concat(c.baseUrl,"/cards"),{method:"GET",headers:c.headers}).then((function(e){return a(e)}))]).then((function(t){return E.textContent=t[0].name,C.textContent=t[0].about,k.style='background-image: url("'.concat(t[0].avatar,'")'),e=t[0]._id,t[1].forEach((function(t){m.append(l(t,D,e))}))})).catch((function(e){console.log(e)})),A.addEventListener("submit",(function(e){var t,n;e.preventDefault(),M(!0),(t=U.value,n=P.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return a(e)}))).then((function(e){E.textContent=e.name,C.textContent=e.about,o(_),A.reset()})).catch((function(e){console.log(e)})).finally((function(){return M(!1)}))})),T.addEventListener("submit",(function(t){t.preventDefault();var n,r,i,u={name:T.name.value,link:T.link.value};M(!0),(n=u,r=n.name,i=n.link,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:r,link:i})}).then((function(e){return a(e)}))).then((function(t){console.log(e),m.prepend(l(t,D,e))})).then((function(){p(T,w),o(v),T.reset()})).catch((function(e){console.log(e)})).finally((function(){return M(!1)}))})),h.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return o(e)})),e.addEventListener("click",r)})),L.addEventListener("click",(function(){U.value=E.textContent,P.value=C.textContent,p(A,w),n(_)})),q.addEventListener("click",(function(){n(v)})),k.addEventListener("click",(function(){p(B,w),n(g)})),B.addEventListener("submit",(function(){var e;M(!0),(e=B.image.value,fetch("".concat(c.baseUrl,"/users/me/avatar "),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then((function(e){return a(e)}))).then((function(e){console.log(e),k.style='background-image: url("'.concat(e.avatar,'")'),o(g),B.reset()})).catch((function(e){console.log(e)})).finally((function(){return M(!1)}))}))})();
//# sourceMappingURL=main.js.map